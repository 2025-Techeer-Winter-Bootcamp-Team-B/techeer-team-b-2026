# λ§¤λ§¤ κ±°λ λ‚΄μ—­ μμ§‘ μ—”λ“ν¬μΈνΈ κ²€ν†  κ²°κ³Ό

## β… μμ • μ™„λ£ μ‚¬ν•­

### 1. **μ—”λ“ν¬μΈνΈ κ²½λ΅ μμ •**
- **λ³€κ²½ μ „**: `/transactions/sale`
- **λ³€κ²½ ν›„**: `/transactions/sales` (λ‹¤λ¥Έ μ—”λ“ν¬μΈνΈμ™€ μΌκ΄€μ„± μ μ§€)

### 2. **νλΌλ―Έν„° λ°©μ‹ μμ •**
- **λ³€κ²½ μ „**: `TransactionRequestSchema`λ¥Ό `Body`λ΅ λ°›μ
- **λ³€κ²½ ν›„**: `lawd_cd`, `deal_ymd`λ¥Ό `Query` νλΌλ―Έν„°λ΅ λ°›μ
- **μ΄μ **: 
  - μ„λΉ„μ¤ λ©”μ„λ“ μ‹κ·Έλ‹μ²μ™€ μΌμΉ (`lawd_cd`, `deal_ymd` κ°λ³„ νλΌλ―Έν„°)
  - λ‹¤λ¥Έ μ—”λ“ν¬μΈνΈλ“¤κ³Ό μΌκ΄€μ„± μ μ§€
  - RESTful API μ„¤κ³„ μ›μΉ™μ— λ¶€ν•© (GET/POSTμ μΏΌλ¦¬ νλΌλ―Έν„° μ‚¬μ©)

### 3. **Import λ¬Έμ  ν•΄κ²°**
- **λ¬Έμ **: `TransactionRequestSchema`, `Body` import μ—†μ
- **ν•΄κ²°**: Query νλΌλ―Έν„°λ΅ λ³€κ²½ν•μ—¬ λ¶ν•„μ”ν• import μ κ±°

### 4. **μμ™Έ μ²λ¦¬ λ³΄μ™„**
- **μ¶”κ°€λ μμ™Έ μ²λ¦¬**:
  - `HTTPException` μ „ν (400 Bad Request λ“±)
  - `ValueError` μ²λ¦¬ (μ„¤μ • μ¤λ¥)
  - `Exception` μ²λ¦¬ (κΈ°νƒ€ μ¤λ¥)
- **μΌκ΄€μ„±**: λ‹¤λ¥Έ μ—”λ“ν¬μΈνΈλ“¤κ³Ό λ™μΌν• μμ™Έ μ²λ¦¬ ν¨ν„΄

### 5. **λ¬Έμ„ν™” κ°μ„ **
- Swagger λ¬Έμ„μ— μƒμ„Έν• μ„¤λ… μ¶”κ°€
- νλΌλ―Έν„° κ²€μ¦ λ΅μ§ μ¶”κ°€
- μ‘λ‹µ μ½”λ“ λ…μ‹ (200, 400, 500)

## π“‹ μµμΆ… μ—”λ“ν¬μΈνΈ κµ¬μ΅°

```python
@router.post(
    "/transactions/sales",
    response_model=SaleCollectionResponse,
    status_code=status.HTTP_200_OK,
    tags=["π“¥ Data Collection (λ°μ΄ν„° μμ§‘)"],
    summary="μ•„ννΈ λ§¤λ§¤ κ±°λ λ°μ΄ν„° μμ§‘",
    ...
)
async def collect_sale_transactions(
    db: AsyncSession = Depends(get_db),
    lawd_cd: str = Query(..., description="λ²•μ •λ™μ½”λ“ (5μλ¦¬, μ: 11110)", min_length=5, max_length=5),
    deal_ymd: str = Query(..., description="κ³„μ•½λ…„μ›” (YYYYMM ν•μ‹, μ: 202407)", min_length=6, max_length=6)
) -> SaleCollectionResponse:
```

## π” μμ™Έ μ²λ¦¬ λ¶„μ„

### μ—”λ“ν¬μΈνΈ λ μ΄μ–΄ μμ™Έ μ²λ¦¬

```python
try:
    # νλΌλ―Έν„° κ²€μ¦
    if not lawd_cd.isdigit() or len(lawd_cd) != 5:
        raise HTTPException(status_code=400, ...)
    
    # μ„λΉ„μ¤ νΈμ¶
    result = await data_collection_service.collect_sale_transactions(...)
    return result
    
except HTTPException:
    raise  # HTTPExceptionμ€ κ·Έλ€λ΅ μ „ν
except ValueError as e:
    # μ„¤μ • μ¤λ¥ (API ν‚¤ μ—†μ λ“±)
    raise HTTPException(status_code=500, ...)
except Exception as e:
    # κΈ°νƒ€ μμƒμΉ λ»ν• μ¤λ¥
    raise HTTPException(status_code=500, ...)
```

### μ„λΉ„μ¤ λ μ΄μ–΄ μμ™Έ μ²λ¦¬

```python
async def collect_sale_transactions(...) -> SaleCollectionResponse:
    try:
        # API νΈμ¶, νμ‹±, μ €μ¥ λ΅μ§
        ...
        return SaleCollectionResponse(success=True, ...)
    except Exception as e:
        # λ¨λ“  μμ™Έλ¥Ό μ΅μ•„μ„ SaleCollectionResponseλ΅ λ°ν™
        return SaleCollectionResponse(
            success=False,
            errors=[str(e)],
            ...
        )
```

## β… μμ™Έ μ²λ¦¬ μ¶©λ¶„μ„± ν‰κ°€

### **μ¶©λ¶„ν•©λ‹λ‹¤!** β…

**μ΄μ :**

1. **μ„λΉ„μ¤ λ μ΄μ–΄μ ν¬κ΄„μ  μμ™Έ μ²λ¦¬**
   - μ„λΉ„μ¤ λ©”μ„λ“λ” λ¨λ“  μμ™Έλ¥Ό λ‚΄λ¶€μ μΌλ΅ μ²λ¦¬
   - μμ™Έ λ°μƒ μ‹μ—λ„ `SaleCollectionResponse`λ¥Ό λ°ν™ν•μ—¬ API μ‘λ‹µ λ³΄μ¥
   - `errors` λ¦¬μ¤νΈμ— μ¤λ¥ λ©”μ‹μ§€ μμ§‘

2. **μ—”λ“ν¬μΈνΈ λ μ΄μ–΄μ μ¶”κ°€ λ³΄νΈ**
   - νλΌλ―Έν„° κ²€μ¦ (400 Bad Request)
   - μ„¤μ • μ¤λ¥ μ²λ¦¬ (500 Internal Server Error)
   - μμƒμΉ λ»ν• μμ™Έ μ²λ¦¬ (500 Internal Server Error)

3. **μ΄μ¤‘ μ•μ „μ¥μΉ**
   - μ„λΉ„μ¤ λ μ΄μ–΄: λΉ„μ¦λ‹μ¤ λ΅μ§ μ¤λ¥ μ²λ¦¬
   - μ—”λ“ν¬μΈνΈ λ μ΄μ–΄: HTTP λ λ²¨ μ¤λ¥ μ²λ¦¬
   - λ‘ λ‹¤ μμΌλ©΄ λ” μ•μ „ν•¨

### μμ™Έ μ²λ¦¬ νλ¦„

```
1. ν΄λΌμ΄μ–ΈνΈ μ”μ²­
   β†“
2. μ—”λ“ν¬μΈνΈ: νλΌλ―Έν„° κ²€μ¦ (400 μ¤λ¥ κ°€λ¥)
   β†“
3. μ—”λ“ν¬μΈνΈ: μ„λΉ„μ¤ νΈμ¶
   β†“
4. μ„λΉ„μ¤: API νΈμ¶, νμ‹±, μ €μ¥
   - API νΈμ¶ μ‹¤ν¨ β†’ errorsμ— μ¶”κ°€, κ³„μ† μ§„ν–‰
   - νμ‹± μ‹¤ν¨ β†’ errorsμ— μ¶”κ°€, κ³„μ† μ§„ν–‰
   - μ €μ¥ μ‹¤ν¨ β†’ errorsμ— μ¶”κ°€, κ³„μ† μ§„ν–‰
   β†“
5. μ„λΉ„μ¤: SaleCollectionResponse λ°ν™ (ν•­μƒ λ°ν™)
   β†“
6. μ—”λ“ν¬μΈνΈ: κ²°κ³Ό λ°ν™
   - μ„λΉ„μ¤κ°€ μ •μƒ λ°ν™ β†’ 200 OK
   - μμƒμΉ λ»ν• μμ™Έ λ°μƒ β†’ 500 Internal Server Error
```

## π― κ¶μ¥μ‚¬ν•­

### ν„μ¬ κµ¬μ΅°κ°€ μ μ ν•©λ‹λ‹¤

1. **μ„λΉ„μ¤ λ μ΄μ–΄**: 
   - λΉ„μ¦λ‹μ¤ λ΅μ§ μ¤λ¥λ” λ‚΄λ¶€μ μΌλ΅ μ²λ¦¬
   - λ¶€λ¶„ μ‹¤ν¨λ„ ν—μ© (μΌλ¶€ κ±°λλ” μ„±κ³µ, μΌλ¶€λ” μ‹¤ν¨)
   - `SaleCollectionResponse`λ΅ μƒμ„Έν• κ²°κ³Ό λ°ν™

2. **μ—”λ“ν¬μΈνΈ λ μ΄μ–΄**:
   - HTTP λ λ²¨ κ²€μ¦ λ° μ¤λ¥ μ²λ¦¬
   - ν΄λΌμ΄μ–ΈνΈμ—κ² λ…ν™•ν• μ¤λ¥ λ©”μ‹μ§€ μ κ³µ
   - μμƒμΉ λ»ν• μμ™Έμ— λ€ν• μ•μ „μ¥μΉ

### μ¶”κ°€ κ°μ„  κ°€λ¥ μ‚¬ν•­ (μ„ νƒμ‚¬ν•­)

1. **νƒ€μ„μ•„μ›ƒ μ²λ¦¬**: 
   - API νΈμ¶μ΄ λ„λ¬΄ μ¤λ κ±Έλ¦΄ κ²½μ° νƒ€μ„μ•„μ›ƒ μ„¤μ •
   - ν„μ¬λ” μ„λΉ„μ¤ λ μ΄μ–΄μ—μ„ μ²λ¦¬ κ°€λ¥

2. **μ¬μ‹λ„ λ΅μ§**:
   - μΌμ‹μ μΈ λ„¤νΈμ›ν¬ μ¤λ¥ μ‹ μ¬μ‹λ„
   - μ„λΉ„μ¤ λ μ΄μ–΄μ— μ¶”κ°€ κ°€λ¥

3. **μƒμ„Έν• λ΅κΉ…**:
   - ν„μ¬λ„ μ¶©λ¶„ν•μ§€λ§, λ” μƒμ„Έν• λ©”νΈλ¦­ μμ§‘ κ°€λ¥

## π“ μµμΆ… κ²°λ΅ 

### β… μ—”λ“ν¬μΈνΈ κµ¬μ΅°: **λ¬Έμ  μ—†μ**
- μ„λΉ„μ¤ λ©”μ„λ“ μ‹κ·Έλ‹μ²μ™€ μΌμΉ
- λ‹¤λ¥Έ μ—”λ“ν¬μΈνΈμ™€ μΌκ΄€μ„± μ μ§€
- RESTful API μ„¤κ³„ μ›μΉ™ μ¤€μ

### β… μμ™Έ μ²λ¦¬: **μ¶©λ¶„ν•¨**
- μ„λΉ„μ¤ λ μ΄μ–΄: ν¬κ΄„μ  μμ™Έ μ²λ¦¬
- μ—”λ“ν¬μΈνΈ λ μ΄μ–΄: HTTP λ λ²¨ λ³΄νΈ
- μ΄μ¤‘ μ•μ „μ¥μΉλ΅ μ•μ •μ„± ν™•λ³΄

### β… μ½”λ“ ν’μ§: **μ–‘νΈ**
- λ…ν™•ν• νλΌλ―Έν„° κ²€μ¦
- μƒμ„Έν• λ¬Έμ„ν™”
- μΌκ΄€λ μ¤λ¥ μ²λ¦¬ ν¨ν„΄
