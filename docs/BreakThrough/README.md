# 💡 BreakThrough - 문제 해결 및 최적화 목록

SWEETHOME 프로젝트에서 해결한 문제점과 최적화 사례를 정리합니다.

> **총 35개의 문제 해결 및 최적화 사례**

---

## 📊 카테고리별 요약

| 카테고리 | 건수 | 상세 문서 |
|----------|------|----------|
| 성능 최적화 | 12건 | [Performance.md](./Performance.md) |
| 데이터베이스 | 10건 | [Database.md](./Database.md) |
| 매칭 알고리즘 | 8건 | [Matching.md](./Matching.md) |
| 기타 (인증, 에러 처리 등) | 5건 | 아래 참조 |

---

## 🚀 전체 문제 해결 목록

### 성능 최적화 (12건)

| # | 문제 | 해결 방법 | 개선율 |
|---|------|----------|--------|
| 1 | 검색 속도 느림 (2-3초) | 2단계 검색 알고리즘 도입 | **95%↓** |
| 2 | 통계 쿼리 느림 (3-5초) | Materialized View 적용 | **95%↓** |
| 3 | Cold Start 문제 (첫 요청 5초+) | 캐시 예열 (Cache Warmup) | **98%↓** |
| 4 | JSON 직렬화 느림 | orjson 적용 | **80%↓** |
| 5 | Connection Pool 부족 | pool_size 20, max_overflow 40 | **4x 증가** |
| 6 | 동시 요청 처리 부족 | FastAPI 비동기 + Uvicorn 워커 | **5x 증가** |
| 7 | 통계 캐시 미스 높음 | 필터 조합별 캐시 키 해시화 | **80% 히트율** |
| 8 | 캐시 무효화 불완전 | 패턴 매칭 기반 선택적 무효화 | **정확도 100%** |
| 9 | 서브쿼리 남용 | JOIN으로 전환 | **50%↓** |
| 10 | N+1 문제 | 배치 조회 + selectinload | **90%↓** |
| 11 | 응답 시간 모니터링 부재 | Prometheus + Grafana 도입 | **실시간 모니터링** |
| 12 | 느린 요청 감지 불가 | 커스텀 미들웨어로 5초 초과 경고 | **자동 감지** |

### 데이터베이스 최적화 (10건)

| # | 문제 | 해결 방법 | 개선율 |
|---|------|----------|--------|
| 13 | LIKE '%keyword%' 느림 | pg_trgm GIN 인덱스 | **95%↓** |
| 14 | 복합 조건 쿼리 느림 | 복합 인덱스 (Partial Index) | **3-5x 향상** |
| 15 | 삭제된 데이터 인덱싱 | WHERE is_deleted=FALSE Partial Index | **저장 공간 30%↓** |
| 16 | 공간 검색 느림 | PostGIS + GIST 인덱스 | **95%↓** |
| 17 | 통계 집계 반복 계산 | 일일 통계 테이블 + 증분 집계 | **80%↓** |
| 18 | 외래키 제약조건 누락 | 모든 FK 제약조건 추가 | **데이터 무결성 확보** |
| 19 | 인덱스 누락 | 주요 조회 컬럼에 인덱스 추가 | **쿼리 성능 향상** |
| 20 | 스키마 PK/FK 주석 오류 | 모델 파일에서 올바르게 정의 | **명확한 관계 정의** |
| 21 | Connection 끊김 문제 | pool_pre_ping=True 설정 | **자동 재연결** |
| 22 | 장시간 연결 문제 | pool_recycle=1800 (30분) | **안정성 확보** |

### 매칭 알고리즘 개선 (8건)

| # | 문제 | 해결 방법 | 개선율 |
|---|------|----------|--------|
| 23 | 아파트명 불일치 (띄어쓰기) | 6가지 이름 매칭 전략 | **정확도 95%↑** |
| 24 | 시군구 코드 비교 오류 | 타입 변환 및 None 처리 강화 | **오류 0%** |
| 25 | 동 매칭 실패 | 양방향 포함 관계 + 부분 매칭 | **매칭율 향상** |
| 26 | 필터링 너무 엄격 | 후보 복원 및 재시도 로직 | **매칭율 향상** |
| 27 | 지번 주소 파싱 오류 | 정규식 패턴 개선 | **파싱 정확도 향상** |
| 28 | 후보 아파트 없음 | 원래 후보로 복원 | **매칭 기회 증가** |
| 29 | 아파트명 정규화 차이 | 통일된 정규화 함수 적용 | **일관성 확보** |
| 30 | 스코어링 불명확 | 가중치 기반 스코어링 (0.5/0.3/0.2) | **명확한 기준** |

### 기타 (5건)

| # | 문제 | 해결 방법 | 결과 |
|---|------|----------|------|
| 31 | 인증 구현 복잡 | Clerk 도입 | **구현 시간 85%↓** |
| 32 | 사용자 동기화 누락 | Clerk 웹훅으로 자동 동기화 | **실시간 동기화** |
| 33 | 에러 응답 불일치 | 표준화된 에러 코드 및 응답 형식 | **일관된 에러 처리** |
| 34 | API 문서화 부담 | FastAPI 자동 문서화 (Swagger) | **문서화 자동** |
| 35 | 환경별 설정 관리 | .env 파일 + Pydantic Settings | **환경 분리 완료** |

---

## 📈 전체 성능 개선 효과

| 지표 | 개선 전 | 개선 후 | 개선율 |
|------|---------|---------|--------|
| 검색 응답 시간 | 2-3초 | 50-100ms | **95%↓** |
| 통계 쿼리 시간 | 3-5초 | 100-200ms | **95%↓** |
| 첫 요청 응답 시간 | 5초+ | 100ms | **98%↓** |
| 동시 요청 처리 | 50 RPS | 500 RPS | **10x↑** |
| 캐시 히트율 | 0% | 80%+ | - |
| 아파트 매칭 정확도 | 70% | 95% | **36%↑** |

---

## 📁 상세 문서

- [Performance.md](./Performance.md) - 성능 최적화 상세
- [Database.md](./Database.md) - 데이터베이스 최적화 상세
- [Matching.md](./Matching.md) - 매칭 알고리즘 개선 상세

---

## 🔍 문제 해결 원칙

### 1. 측정 우선
```
"성능 최적화는 측정에서 시작한다"
- Prometheus/Grafana로 병목 지점 정확히 파악
- EXPLAIN ANALYZE로 쿼리 성능 분석
```

### 2. 단계적 개선
```
1. 가장 큰 병목 먼저 해결
2. 적용 후 측정으로 효과 확인
3. 다음 병목으로 이동
```

### 3. 트레이드오프 고려
```
- 캐시 용량 vs 응답 속도
- 인덱스 저장 공간 vs 쿼리 성능
- 코드 복잡도 vs 성능 향상
```
